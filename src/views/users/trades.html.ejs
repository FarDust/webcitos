<h1>Trades history</h1>

<% if (trades.length == 0) { %>
<p>You don't have any trades yet.</p>
<% } %>

<% if (trades.length > 0) { %>
<% let i = -1 %>
<div class="row">
  <% trades.forEach(trade => { %>
  <% i += 1 %>
  <div class="col-3">
    <div class="card">
      <div class="card-context">
          <h4 class="card-header"> Trade for <%= trade.publication.title %></h4>
          <div class="card-content">
            Current state: <%= trade.state %> <br>
            <% if (trade.id_request !== null ) { %>
              Assigned request:
              <a href="<%= requestsUrl + trade.id_request.toString() %>">
                <%= trade.receptor.item.model %>
              </a>
            <% } %>
          </div>
          <div class="card-footer">
            <!-- Buttons here! -->
            <button class="button primary" onclick="window.location.href='<%= tradesUrl + trade.id.toString() %>'">
              See trade
            </button>
            <% let edit_string = '/edit' %>
            <% if (trade.state == 'pendent') { %>
              <button class="button primary" onclick="window.location.href='<%= tradesUrl + trade.id.toString() + edit_string %>'">
                Finish trade
              </button>
            <% } else if (trade.state == 'concreted' && reviews[i]) { %>
              <button class="button primary" onclick="window.location.href='<%= reviewsUrl + reviews[i].id.toString() %>'">
                See review
              </button>
            <% } else if (trade.state == 'concreted' && ( trade.emmiter.id === currentUser.id || trade.receptor.id === currentUser.id ) ) { %>
                <button class="button primary" onclick="window.location.href='<%= reviewNewUrl + trade.id.toString() %>'">
                  Add review
                </button>
            <% } %>
          </div>
      </div>
    </div>
  </div>
  <% }) %>
</div>
<% } %>
